var c;var cc;var scl=15;const VOID=-1;const SPACE=0;const EARTH=1;const WATER=2;const MOON=3;const OBSTACLE=4;const keyState={};const MOVE_LEFT=37;const MOVE_UP=38;const MOVE_RIGHT=39;const MOVE_DOWN=40;const KEY_RESET=82;var lastKeyCode=0;var gameOver=0;var jumpUp=0;var resetJump=0;var gameLoopInterval;var renderInterval;var playerBase=0;function startMovement(){if(keyState[MOVE_RIGHT]||keyState[MOVE_LEFT]){var b=astronaut.posX;var a=astronaut.posY;map.map[[b,a]]=initialMap[[b,a]];astronaut.posX+=keyState[MOVE_RIGHT]?1:0;astronaut.posX-=keyState[MOVE_LEFT]?1:0}if(keyState[MOVE_UP]&&astronaut.posY==playerBase){jumpUp=1}}function gameLoop(){gameLoopInterval=setInterval(startMovement,50)}document.onkeydown=function(a){if(a.keyCode==KEY_RESET){init();return}keyState[a.keyCode||a.which]=true};document.onkeyup=function(a){keyState[a.keyCode||a.which]=false};var initialMap=[[]];var map={x:Math.floor(640/scl),y:Math.floor(360/scl)-1,map:[[]],initMap:function(){console.log(map.x+", "+map.y);for(var a=0;a<=map.x;a++){for(var b=0;b<=map.y;b++){if(b>map.y-2){map.map[[a,b]]=OBSTACLE;initialMap[[a,b]]=OBSTACLE;continue}if(Math.random()>0.9){map.map[[a,b]]=SPACE;initialMap[[a,b]]=SPACE}else{map.map[[a,b]]=VOID;initialMap[[a,b]]=VOID}}}},renderMap:function(){if(jumpUp&&astronaut.posY<=(playerBase-8)){jumpUp=0;resetJump=1}else{if(resetJump&&astronaut.posY>=playerBase){astronaut.posY=playerBase;resetJump=0}}var e=astronaut.posX;var b=astronaut.posY;astronaut.posY=astronaut.posY-jumpUp+resetJump;if(map.map[[e,b]]==OBSTACLE){gameOver=1}map.map[[25,47]]=OBSTACLE;if(jumpUp||resetJump){map.map[[e,b]]=initialMap[[e,b]]}map.map[[astronaut.posX,astronaut.posY]]=EARTH;cc.font="15px Arial";for(var a=0;a<=map.x;a++){for(var d=0;d<=map.y;d++){switch(map.map[[a,d]]){case VOID:cc.fillStyle=gameOver?"red":"#000000";cc.fillText(" ",a*scl+5,d*scl+10);break;case OBSTACLE:cc.fillStyle=gameOver?"red":"#444444";cc.fillText("#",a*scl+5,d*scl+10);break;case SPACE:cc.fillStyle=gameOver?"red":"#aaaaaa";cc.fillText(".",a*scl+5,d*scl+10);break;case EARTH:cc.fillStyle=gameOver?"red":"white";cc.fillText("@",a*scl+5,d*scl+10);break}}}}};var astronaut={posX:0,posY:0};window.onload=function(){c=document.getElementById("gc");cc=c.getContext("2d");init()};function init(){playerBase=map.y-2;gameOver=0;astronaut.posX=0;astronaut.posY=playerBase;map.initMap();update();gameLoop();renderInterval=setInterval(update,50)}function update(){if(gameOver){clearInterval(renderInterval);clearInterval(gameLoopInterval);return}render()}function render(){cc.fillStyle="black";cc.fillRect(0,0,c.width,c.height);map.renderMap()}function addObstacle(){};